---
title: "AndroidのウィジェットをタップしてActivityを起動したい"
emoji: "🗂"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---

本記事ではAndroidアプリ開発の中でも、ウィジェットに対してタップ時の動作を仕込む際に注意すべき点を書いています。

# 結論
PendingIntentを使ってBroadcastを発行します。  

```java:SampleWidget.java
// create broadcast intent
Intent intent = new Intent(context, SampleWidget.class);
intent.setAction("ACTION_APPWIDGET_TAPPED");
views.setOnClickPendingIntent(
        R.id.appwidget_text,
        PendingIntent.getBroadcast(
                context,
                0,
                intent,
                PendingIntent.FLAG_IMMUTABLE
        )
);
    
```

AndroidManifest.xmlにreceiverを登録します。

```xml:AndroidManifest.xml
<receiver
    android:name=".SampleWidget"
    android:exported="false">
    <intent-filter>
        <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
    </intent-filter>

    <meta-data
        android:name="android.appwidget.provider"
        android:resource="@xml/sample_widget_info" />
</receiver>


</manifest>
```

発行したBroadcastをウィジェット側で受け取ります。
```java:SampleWidget.java
// receive broadcast and open main activity
@Override
public void onReceive(Context context, Intent intent) {
    super.onReceive(context, intent);

    // create an intent to open the main activity
    Intent mainActivityIntent = new Intent(context, MainActivity.class);
    mainActivityIntent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);

    // check if the broadcast is from the widget
    if (Objects.equals(intent.getAction(), "ACTION_APPWIDGET_TAPPED")) {
        context.startActivity(mainActivityIntent);
    }
}
```


PendingIntentとは？  
Broadcastって何？

１つずつ解説します。


# setOnClickListenerが効かない！？
Android アプリ開発において、タップしたときの動作を仕込むことは鉄板です。  

# PendingIntentとは？

## setOnPendingIntent

## setAction

## Broadcast

# まとめ
ウィジェットにタップ時の動作を仕込むにはPendingIntentを使ってBroadcastを発行する。

# 宣伝
アプリ

